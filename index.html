<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدقق أصالة الآيفون - تأكد من جهازك</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        .card-gradient {
            background: linear-gradient(145deg, #f9fafb, #e5e7eb);
        }
        .btn-gradient {
            background: linear-gradient(to right, #2563eb, #3b82f6);
            transition: all 0.3s ease-in-out;
        }
        .btn-gradient:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3), 0 4px 6px -2px rgba(59, 130, 246, 0.2);
        }
        .btn-gradient:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .result-card {
            transition: all 0.5s ease-in-out;
            transform: scale(0.95);
            opacity: 0;
            max-height: 0;
            overflow: hidden;
        }
        .result-card.show {
            transform: scale(1);
            opacity: 1;
            max-height: 1200px; /* Increased height */
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border-left-color: #fff;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab {
            transition: all 0.3s;
        }
        .tab-active {
            background-color: #3b82f6;
            color: white;
        }
        .tab-inactive {
            background-color: #e5e7eb;
            color: #4b5563;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">
                <span class="text-blue-600">الدليل الشامل</span> لفحص الآيفون
            </h1>
            <p class="mt-2 text-lg text-gray-600">أداة ذكية ومتكاملة لفحص أصالة ومواصفات جهازك خطوة بخطوة.</p>
        </header>

        <!-- Step 1: Main Checker Card -->
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 max-w-2xl mx-auto">
            <div class="flex flex-col items-center">
                 <h2 class="text-2xl font-semibold text-center mb-4">1. التحقق من المعرّف وتحديد المواصفات</h2>
                
                <div class="w-full max-w-sm mx-auto bg-gray-200 rounded-lg p-1 flex mb-4">
                    <button id="tabSerial" class="tab tab-active w-1/2 rounded-md py-2 font-semibold">الرقم التسلسلي</button>
                    <button id="tabImei" class="tab tab-inactive w-1/2 rounded-md py-2 font-semibold">IMEI</button>
                </div>

                <p id="helperText" class="text-gray-500 text-center mb-6">أدخل الرقم ليقوم الذكاء الاصطناعي بتحليله وتحديد مواصفات الجهاز.</p>
                
                <div class="w-full">
                    <input type="text" id="identifierInput" placeholder="أدخل الرقم التسلسلي هنا" class="w-full px-5 py-3 text-lg text-center border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300">
                </div>
                
                <button id="checkButton" class="btn-gradient text-white font-bold py-3 px-10 rounded-lg mt-6 w-full sm:w-auto text-lg shadow-md flex items-center justify-center gap-2">
                    <span id="buttonText">تحليل بالذكاء الاصطناعي</span>
                    <span id="loadingSpinner" class="hidden spinner"></span>
                </button>
            </div>
        </div>
        
        <!-- Result Display -->
        <div id="resultContainer" class="result-card max-w-2xl mx-auto mt-6"></div>

        <!-- Step 2: AI Image Analysis Section -->
        <div class="max-w-2xl mx-auto mt-8 bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <h2 class="text-2xl font-semibold text-center mb-4">2. تحليل الصورة بالذكاء الاصطناعي</h2>
            <p class="text-gray-500 text-center mb-6">ارفع صورة للآيفون أو علبته ليقوم الذكاء الاصطناعي بفحصها بحثاً عن علامات التزييف.</p>
            <div class="flex flex-col items-center">
                <input type="file" id="imageUpload" accept="image/*" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
                <img id="imagePreview" src="" alt="معاينة الصورة" class="mt-4 rounded-lg max-h-60 hidden shadow-md"/>
                <button id="analyzeImageButton" class="btn-gradient text-white font-bold py-3 px-10 rounded-lg mt-6 w-full sm:w-auto text-lg shadow-md" disabled>
                    تحليل الصورة
                </button>
                <div id="aiImageAnalysisResult" class="mt-4 w-full text-right"></div>
            </div>
        </div>
        
        <!-- Step 3: Parts and Service History Section -->
        <div class="max-w-2xl mx-auto mt-8 bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <h2 class="text-2xl font-semibold text-center mb-4">3. التحقق من سجل القطع والخدمة</h2>
            <p class="text-gray-500 text-center mb-6">تأكد إذا تم استبدال أي قطعة في الجهاز وما إذا كانت أصلية (يتطلب iOS 15.2 أو أحدث).</p>
            <div class="text-right space-y-4">
                <div>
                    <h3 class="font-bold text-lg text-blue-700">كيفية التحقق:</h3>
                    <p class="text-gray-700">اذهب إلى <span class="font-semibold">الإعدادات > عام > حول</span>. إذا تم إجراء إصلاحات، سيظهر قسم "سجل القطع والخدمة".</p>
                </div>
                <div class="p-4 rounded-lg bg-green-50 border border-green-200">
                     <h4 class="font-semibold text-green-800">قطعة أصلية من Apple</h4>
                     <p class="text-green-700">هذا يعني أن القطعة أصلية من آبل وتم تركيبها بشكل صحيح.</p>
                </div>
                <div class="p-4 rounded-lg bg-yellow-50 border border-yellow-200">
                     <h4 class="font-semibold text-yellow-800">قطعة غير معروفة</h4>
                     <p class="text-yellow-700">هذا يعني أن القطعة المُركبة إما غير أصلية، أو لا تعمل كما هو متوقع. هذا تحذير مهم.</p>
                </div>
            </div>
        </div>

        <!-- Step 4: Battery Health Analysis -->
        <div class="max-w-2xl mx-auto mt-8 bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <h2 class="text-2xl font-semibold text-center mb-4">4. تحليل صحة البطارية بالذكاء الاصطناعي</h2>
            <p class="text-gray-500 text-center mb-6">أدخل بيانات البطارية من الإعدادات > البطارية > حالة البطارية والشحن.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="batteryCapacity" class="font-semibold text-gray-700">الحد الأقصى للسعة (٪)</label>
                    <input type="number" id="batteryCapacity" placeholder="مثال: 88" class="w-full mt-1 px-4 py-2 text-center border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="batteryCycles" class="font-semibold text-gray-700">عدد دورات الشحن (اختياري)</label>
                    <input type="number" id="batteryCycles" placeholder="مثال: 550" class="w-full mt-1 px-4 py-2 text-center border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <div class="flex justify-center">
                <button id="analyzeBatteryButton" class="btn-gradient text-white font-bold py-3 px-10 rounded-lg mt-6 text-lg shadow-md">
                    تحليل البطارية
                </button>
            </div>
            <div id="aiBatteryAnalysisResult" class="mt-4 w-full text-right"></div>
        </div>

        <!-- Step 5: Manual Checklist -->
        <div class="max-w-2xl mx-auto mt-8 bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <h2 class="text-2xl font-semibold text-center mb-4">5. قائمة الفحص اليدوي النهائية</h2>
            <p class="text-gray-500 text-center mb-6">استخدم هذه القائمة كمرجع أخير للتأكد من كل شيء بنفسك.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                <div class="text-right">
                    <h3 class="font-bold text-lg text-blue-700 mb-2">الفحص المادي</h3>
                    <ul class="list-disc list-inside space-y-2 text-gray-700">
                        <li>**جودة المواد:** المس الجهاز، هل يبدو صلباً ومصنوعاً من الزجاج والمعدن؟</li>
                        <li>**الأزرار:** اضغط على أزرار الصوت والطاقة، هل هي ثابتة ومستجيبة؟</li>
                        <li>**شعار آبل:** هل الشعار مدمج بسلاسة مع ظهر الجهاز وله انعكاس المرآة؟</li>
                        <li>**منفذ الشحن:** هل هو من نوع Lightning أو USB-C (لآيفون 15 وأحدث)؟</li>
                    </ul>
                </div>
                <div class="text-right">
                    <h3 class="font-bold text-lg text-blue-700 mb-2">فحص النظام والبرامج</h3>
                    <ul class="list-disc list-inside space-y-2 text-gray-700">
                        <li>**متجر التطبيقات:** افتح المتجر، هل هو App Store أم متجر آخر مثل Google Play؟</li>
                        <li>**المساعد الصوتي:** اضغط باستمرار على زر الطاقة، هل يظهر المساعد الصوتي Siri؟</li>
                        <li>**التطبيقات الأساسية:** هل تجد تطبيقات مثل Safari, Health, Wallet؟</li>
                        <li>**سلاسة النظام:** هل التنقل بين التطبيقات وفتحها سلس وسريع؟</li>
                    </ul>
                </div>
            </div>
        </div>


        <!-- Footer -->
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p><strong>إخلاء مسؤولية:</strong> هذه الأداة تقدم فحصاً أولياً للمساعدة. للحصول على تحقق نهائي ومؤكد، يرجى استخدام <a href="https://checkcoverage.apple.com/" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline font-semibold">موقع التحقق الرسمي من آبل</a>.</p>
            <p class="mt-2">© 2025 مدقق أصالة الآيفون. كل الحقوق محفوظة.</p>
        </footer>

    </div>

    <script>
        // --- DOM Elements ---
        const checkButton = document.getElementById('checkButton');
        const identifierInput = document.getElementById('identifierInput');
        const resultContainer = document.getElementById('resultContainer');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const buttonText = document.getElementById('buttonText');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const analyzeImageButton = document.getElementById('analyzeImageButton');
        const aiImageAnalysisResult = document.getElementById('aiImageAnalysisResult');
        const tabSerial = document.getElementById('tabSerial');
        const tabImei = document.getElementById('tabImei');
        const helperText = document.getElementById('helperText');
        const analyzeBatteryButton = document.getElementById('analyzeBatteryButton');
        const batteryCapacityInput = document.getElementById('batteryCapacity');
        const batteryCyclesInput = document.getElementById('batteryCycles');
        const aiBatteryAnalysisResult = document.getElementById('aiBatteryAnalysisResult');

        // --- State ---
        let imageDataBase64 = null;
        let currentCheckType = 'Serial';
        let identifiedModel = null; // To store the model from step 1

        // --- Event Listeners ---
        tabSerial.addEventListener('click', () => switchTab('Serial'));
        tabImei.addEventListener('click', () => switchTab('IMEI'));
        checkButton.addEventListener('click', analyzeIdentifier);
        analyzeBatteryButton.addEventListener('click', getAIBatteryAnalysis);

        imageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                analyzeImageButton.disabled = true;
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    imageDataBase64 = e.target.result.split(',')[1];
                    analyzeImageButton.disabled = false;
                };
                reader.readAsDataURL(file);
            }
        });

        analyzeImageButton.addEventListener('click', getAIImageAnalysis);

        // --- Functions ---
        function switchTab(type) {
            currentCheckType = type;
            if (type === 'Serial') {
                tabSerial.className = 'tab tab-active w-1/2 rounded-md py-2 font-semibold';
                tabImei.className = 'tab tab-inactive w-1/2 rounded-md py-2 font-semibold';
                helperText.textContent = "أدخل الرقم التسلسلي ليقوم الذكاء الاصطناعي بتحليله وتحديد مواصفات الجهاز.";
                identifierInput.placeholder = "أدخل الرقم التسلسلي هنا";
            } else {
                tabImei.className = 'tab tab-active w-1/2 rounded-md py-2 font-semibold';
                tabSerial.className = 'tab tab-inactive w-1/2 rounded-md py-2 font-semibold';
                helperText.textContent = "أدخل IMEI ليقوم الذكاء الاصطناعي بتحليله.";
                identifierInput.placeholder = "أدخل رقم IMEI هنا";
            }
        }

        async function analyzeIdentifier() {
            const identifier = identifierInput.value.trim();
            identifiedModel = null; // Reset model on new check
            resultContainer.classList.remove('show');
            resultContainer.innerHTML = '';

            if (!identifier) {
                displayResult('error', 'الرجاء إدخال الرقم', `لا يمكن ترك حقل ${currentCheckType === 'Serial' ? 'الرقم التسلسلي' : 'IMEI'} فارغاً.`);
                return;
            }

            buttonText.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            checkButton.disabled = true;

            const prompt = `أنت خبير في معرفات أجهزة آبل. قام مستخدم بإدخال الرقم التالي: '${identifier}' للتحقق منه كـ ${currentCheckType}. بناءً على التنسيقات المعروفة، قم بالتحليل.
            1. هل هيكله وتنسيقه صالحان؟
            2. إذا كان صالحًا، هل يمكنك تحديد طراز الآيفون، واللون، وسعة التخزين المحتملة من الرقم؟ (إذا لم تتمكن من تحديد معلومة معينة، اترك قيمتها null).
            أجب بتنسيق JSON يحتوي على الحقول التالية: "isValid" (boolean), "reason" (string in Arabic), "model" (string or null), "color" (string or null), "storage" (string or null).`;
            
            const schema = {
                type: "OBJECT",
                properties: {
                    isValid: { type: "BOOLEAN" },
                    reason: { type: "STRING" },
                    model: { "type": ["STRING", "NULL"] },
                    color: { "type": ["STRING", "NULL"] },
                    storage: { "type": ["STRING", "NULL"] }
                },
                required: ["isValid", "reason"]
            };

            const analysisResult = await callGeminiAPI(prompt, null, schema);

            if (analysisResult) {
                try {
                    const jsonMatch = analysisResult.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) throw new Error("No valid JSON object found in the AI response.");
                    const jsonString = jsonMatch[0];
                    const parsedResult = JSON.parse(jsonString);

                    if (parsedResult.isValid) {
                        identifiedModel = parsedResult.model; // Save the model for the battery check
                        displayResult('success', `تنسيق ${currentCheckType} يبدو صالحاً`, parsedResult.reason, parsedResult);
                    } else {
                        displayResult('warning', `تنسيق ${currentCheckType} قد يكون غير صالح`, parsedResult.reason, null);
                    }
                } catch (e) {
                    console.error("Error parsing AI response:", e, "Original response:", analysisResult);
                    displayResult('error', 'خطأ في التحليل', 'لم نتمكن من معالجة رد الذكاء الاصطناعي. قد يكون الرد غير متوقع.');
                }
            } else {
                displayResult('error', 'خطأ في الاتصال', 'فشل الاتصال بخادم الذكاء الاصطناعي.');
            }

            buttonText.classList.remove('hidden');
            loadingSpinner.classList.add('hidden');
            checkButton.disabled = false;
        }
        
        async function getAIBatteryAnalysis() {
            const capacity = batteryCapacityInput.value;
            const cycles = batteryCyclesInput.value;

            if (!capacity) {
                aiBatteryAnalysisResult.innerHTML = `<p class="text-red-500 text-center">الرجاء إدخال الحد الأقصى للسعة على الأقل.</p>`;
                return;
            }
            
            analyzeBatteryButton.disabled = true;
            analyzeBatteryButton.innerHTML = '<span class="spinner inline-block"></span> جاري تحليل البطارية...';
            aiBatteryAnalysisResult.innerHTML = '';

            let prompt = `بصفتك خبيرًا في بطاريات الآيفون، قم بتحليل البيانات التالية: الحد الأقصى للسعة هو ${capacity}%.`;
            if (cycles) {
                prompt += ` وعدد دورات الشحن هو ${cycles}.`;
            }
            if (identifiedModel) {
                 prompt += ` هذا الجهاز هو ${identifiedModel}.`;
            }
            prompt += ` بناءً على هذه المعلومات، قدم تحليلاً موجزاً وواضحاً باللغة العربية عن حالة البطارية. هل تبدو طبيعية؟ هل هي مستهلكة؟ هل هناك أي شيء يدعو للقلق؟`;

            const responseText = await callGeminiAPI(prompt);
            
            if (responseText) {
                const formattedText = responseText.replace(/\*/g, '').replace(/\n/g, '<br>');
                aiBatteryAnalysisResult.innerHTML = `<div class="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200">${formattedText}</div>`;
            } else {
                aiBatteryAnalysisResult.innerHTML = '<p class="text-red-500 text-center">عذراً، حدث خطأ أثناء تحليل البطارية.</p>';
            }
            
            analyzeBatteryButton.innerHTML = 'تحليل البطارية';
            analyzeBatteryButton.disabled = false;
        }

        function displayResult(type, title, message, specs) {
            let bgColor, borderColor, icon, titleColor;
            let specsHTML = '';

            if (type === 'success' && specs) {
                specsHTML += `<div class="mt-4 pt-4 border-t border-gray-300 text-right">`;
                specsHTML += `<h4 class="font-bold text-lg mb-2 text-gray-800">المواصفات المحددة:</h4><ul class="space-y-1">`;
                if(specs.model) specsHTML += `<li class="flex justify-between"><span>الطراز:</span><span class="font-semibold">${specs.model}</span></li>`;
                if(specs.color) specsHTML += `<li class="flex justify-between"><span>اللون:</span><span class="font-semibold">${specs.color}</span></li>`;
                if(specs.storage) specsHTML += `<li class="flex justify-between"><span>السعة:</span><span class="font-semibold">${specs.storage}</span></li>`;
                specsHTML += `</ul></div>`;
            }

            switch (type) {
                case 'success':
                    bgColor = 'bg-green-50'; borderColor = 'border-green-500'; titleColor = 'text-green-700';
                    icon = `<svg class="h-12 w-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`;
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-50'; borderColor = 'border-yellow-500'; titleColor = 'text-yellow-700';
                    icon = `<svg class="h-12 w-12 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>`;
                    break;
                case 'error':
                    bgColor = 'bg-red-50'; borderColor = 'border-red-500'; titleColor = 'text-red-700';
                    icon = `<svg class="h-12 w-12 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`;
                    break;
            }

            const resultHTML = `
                <div class="rounded-lg p-6 text-center border-l-4 ${borderColor} ${bgColor}">
                    <div class="flex justify-center mb-4">${icon}</div>
                    <h3 class="text-xl font-bold ${titleColor}">${title}</h3>
                    <p class="mt-2 text-gray-600">${message}</p>
                    ${specsHTML}
                    <a href="https://checkcoverage.apple.com/" target="_blank" rel="noopener noreferrer" class="inline-block mt-4 bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition">التحقق من تغطية آبل الرسمية</a>
                </div>
            `;
            
            resultContainer.innerHTML = resultHTML;
            setTimeout(() => resultContainer.classList.add('show'), 50);
        }

        async function getAIImageAnalysis() {
            if (!imageDataBase64) return;
            analyzeImageButton.disabled = true;
            analyzeImageButton.innerHTML = '<span class="spinner inline-block"></span> جاري التحليل...';
            aiImageAnalysisResult.innerHTML = '';
            const prompt = "أنت خبير في كشف أجهزة آيفون المقلدة. قم بتحليل الصورة المرفقة. ابحث عن أي علامات تدل على أنه قد يكون مقلداً. قدم تحليلك باللغة العربية على شكل قائمة نقطية.";
            const responseText = await callGeminiAPI(prompt, imageDataBase64);
            if (responseText) {
                const formattedText = responseText.replace(/\* /g, '<br>• ').replace(/\n/g, '');
                aiImageAnalysisResult.innerHTML = `<div class="p-4 bg-gray-50 rounded-lg border border-gray-200">${formattedText}</div>`;
            } else {
                aiImageAnalysisResult.innerHTML = '<p class="text-red-500 text-center">عذراً، حدث خطأ أثناء تحليل الصورة.</p>';
            }
            analyzeImageButton.innerHTML = 'تحليل الصورة';
            analyzeImageButton.disabled = false;
        }

        async function callGeminiAPI(prompt, base64Data = null, jsonSchema = null) {
            const maxRetries = 3;
            let attempt = 0;
            let delay = 1000; // Start with 1 second

            while (attempt < maxRetries) {
                try {
                    const apiKey = ""; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    let parts = [{ text: prompt }];
                    if (base64Data) {
                        parts.push({ inlineData: { mimeType: "image/jpeg", data: base64Data } });
                    }
                    const payload = { contents: [{ role: "user", parts: parts }] };
                    if (jsonSchema) {
                        payload.generationConfig = { responseMimeType: "application/json", responseSchema: jsonSchema };
                    }
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API call failed with status: ${response.status}`);
                    }

                    const result = await response.json();
                    return result.candidates?.[0]?.content?.parts?.[0]?.text || null;

                } catch (error) {
                    console.error(`Attempt ${attempt + 1} failed:`, error);
                    attempt++;
                    if (attempt >= maxRetries) {
                        console.error("All API retries failed.");
                        return null;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2; // Exponential backoff
                }
            }
            return null;
        }
    </script>
</body>
</html>
